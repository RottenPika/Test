<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pferdeliebehealthy Rationsrechner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; }
  </style>
</head>
<body class="bg-stone-50">
  <div class="container mx-auto p-4 max-w-4xl">
    <!-- Header -->
    <div class="bg-stone-100 p-4 text-center rounded-t-lg border-b border-pink-200">
      <h1 class="text-2xl font-bold text-pink-700 mb-1">Pferdeliebehealthy.de</h1>
      <p class="text-pink-600">Mit natürlicher Fütterung zu einem gesunden Pferd</p>
    </div>
    
    <!-- Titel -->
    <div class="bg-pink-50 p-3 text-center border-b border-pink-200">
      <h2 class="text-xl font-bold text-stone-700">Rationsrechner Tool für Pferde</h2>
    </div>
    
    <div class="p-4">
      <!-- Pferdedetails -->
      <div class="mb-6 p-4 bg-stone-100 rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Pferdedetails:</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Aktuelles Gewicht (kg)</label>
            <input type="number" id="gewicht" placeholder="z.B. 300" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Zielgewicht (kg)</label>
            <input type="number" id="zielgewicht" placeholder="Optional" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Pferdetyp</label>
            <select id="pferdetyp" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="shetlandpony">Shetland Pony</option>
              <option value="pony">Pony</option>
              <option value="warmblut" selected>Warmblut</option>
              <option value="vollblut">Vollblut</option>
              <option value="kaltblut">Kaltblut</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Jahreszeit</label>
            <select id="jahreszeit" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="normal" selected>Frühling/Sommer/Herbst</option>
              <option value="winter">Winter (+10%)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Arbeitsintensität</label>
            <select id="aktivitaet" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="erhaltung" selected>Erhaltung</option>
              <option value="leicht">Leichte Arbeit</option>
              <option value="mittel">Mittlere Arbeit</option>
              <option value="schwer">Schwere Arbeit</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Haltungsform</label>
            <select id="haltung" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="standard" selected>Standard</option>
              <option value="offenstall">Offenstall (+10%)</option>
              <option value="aktivstall">Aktivstall (+10%)</option>
            </select>
          </div>
          <div class="flex items-center space-x-2">
            <label class="flex items-center text-stone-700 cursor-pointer">
              <input type="checkbox" id="isSenior" class="mr-2 h-4 w-4 border-pink-300 text-pink-500">
              Senior-Pferd (+10%)
            </label>
            <!-- Button nur bei Senior sichtbar -->
            <button id="berechnenSenior" class="hidden p-2 bg-pink-300 hover:bg-pink-400 text-stone-800 rounded">
              Berechnen
            </button>
          </div>
        </div>
      </div>
      
      <!-- Futtermittel -->
      <h3 class="font-bold mb-3 text-pink-700">Futtermittel:</h3>
      <div id="futtermittelContainer">
        <!-- Dynamisch hinzugefügte Einträge -->
      </div>
      <button id="addFuttermittel" class="mt-3 w-full p-2 bg-pink-300 hover:bg-pink-400 text-stone-800 rounded">
        + Futtermittel hinzufügen
      </button>
      
      <!-- Bedarfsanalyse -->
      <div class="mt-6 p-4 bg-stone-100 rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Bedarfsanalyse:</h3>
        <div id="gewichtWarnung" class="mb-4 p-2 bg-stone-200 border border-stone-300 rounded flex items-center text-stone-800">
          <span class="mr-2">⚠️</span>
          Bitte geben Sie das Gewicht des Pferdes ein, um die Bedarfsanalyse zu sehen.
        </div>
        <div id="ergebnisBereich" class="hidden">
          <div class="grid grid-cols-1 gap-3">
            <!-- Anzeige: Bedarf vs. Angebot pro Nährstoff -->
            <div class="flex items-center">
              <div id="ampel-trockensubstanz" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Trockensubstanz: Bedarf: <span id="bedarfTrockensubstanz">0.00</span> kg, 
                Gesamt: <span id="gesamtTrockensubstanz">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-rohfaser" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Rohfaser: Bedarf: <span id="bedarfRohfaser">0.00</span> kg, 
                Gesamt: <span id="gesamtRohfaser">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-rohprotein" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Rohprotein: Bedarf: <span id="bedarfRohprotein">0.00</span> kg, 
                Gesamt: <span id="gesamtRohprotein">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-energie" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Energie: Bedarf: <span id="bedarfEnergie">0.00</span> MJ, 
                Gesamt: <span id="gesamtEnergie">0.00</span> MJ
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-calcium" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Calcium: Bedarf: <span id="bedarfCalcium">0.00</span> kg, 
                Gesamt: <span id="gesamtCalcium">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-phosphor" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Phosphor: Bedarf: <span id="bedarfPhosphor">0.00</span> kg, 
                Gesamt: <span id="gesamtPhosphor">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-magnesium" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Magnesium: Bedarf: <span id="bedarfMagnesium">0.00</span> kg, 
                Gesamt: <span id="gesamtMagnesium">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-natrium" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Natrium: Bedarf: <span id="bedarfNatrium">0.00</span> kg, 
                Gesamt: <span id="gesamtNatrium">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-zucker" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Zucker: Bedarf: <span id="bedarfZucker">0.00</span> kg, 
                Gesamt: <span id="gesamtZucker">0.00</span> kg
              </p>
            </div>
            <!-- Zusätzliche Nährstoffe -->
            <div class="flex items-center">
              <div id="ampel-zink" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Zink: Bedarf: <span id="bedarfZink">0.00</span> kg, 
                Gesamt: <span id="gesamtZink">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-lysin" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Lysin: Bedarf: <span id="bedarfLysin">0.00</span> kg, 
                Gesamt: <span id="gesamtLysin">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-methionin" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Methionin: Bedarf: <span id="bedarfMethionin">0.00</span> kg, 
                Gesamt: <span id="gesamtMethionin">0.00</span> kg
              </p>
            </div>
            <div class="flex items-center">
              <div id="ampel-threonin" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <p class="text-stone-700">
                Threonin: Bedarf: <span id="bedarfThreonin">0.00</span> kg, 
                Gesamt: <span id="gesamtThreonin">0.00</span> kg
              </p>
            </div>
          </div>
          
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-green-500"></div>
              <p class="text-xs text-stone-700">Optimal</p>
            </div>
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-yellow-500"></div>
              <p class="text-xs text-stone-700">Grenzwertig</p>
            </div>
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-red-500"></div>
              <p class="text-xs text-stone-700">Kritisch</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Zusammenfassung -->
      <div class="mt-4 p-4 bg-white rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Weitere Informationen:</h3>
        <p class="text-sm text-stone-700 mb-2">
          • Gesamtfuttermenge: <span id="gesamtFuttermenge">0.00</span> kg
        </p>
        <p class="text-sm text-stone-700 mb-2">
          • Täglicher Heubedarf: <span id="bedarfHeu">0.00</span> kg
        </p>
        <div id="anpassungenBereich" class="mt-2 p-3 rounded bg-stone-100 hidden">
          <p class="text-sm font-semibold text-pink-700 mb-1">Aktive Anpassungen:</p>
          <ul id="anpassungenListe" class="text-xs text-stone-600 pl-4 list-disc"></ul>
        </div>
        <p class="text-sm text-stone-700 mt-2">
          • Die Ampelfarben zeigen, ob die Nährstoffzufuhr im optimalen (grün), grenzwertigen (gelb) oder kritischen (rot) Bereich liegt.
        </p>
      </div>
    </div>
  </div>
  
  <script>
    // --- Vordefinierte Werte für übliche Futtermittel (Presets) bleiben unverändert ---
    const feedPresets = {
      "heu": {
        name: "Heu",
        trockensubstanz: 850,
        rohprotein: 90,
        energie: 2.5,
        zucker: 50,
        rohfaser: 250,
        calcium: 20,
        phosphor: 10,
        magnesium: 5,
        zink: 2,
        natrium: 3,
        lysin: 4,
        methionin: 1.5,
        threonin: 2.5
      },
      "hafer": {
        name: "Hafer",
        trockensubstanz: 880,
        rohprotein: 120,
        energie: 10,
        zucker: 30,
        rohfaser: 150,
        calcium: 10,
        phosphor: 3,
        magnesium: 2,
        zink: 2,
        natrium: 1,
        lysin: 20,
        methionin: 6,
        threonin: 9
      },
      "gerste": {
        name: "Gerste",
        trockensubstanz: 900,
        rohprotein: 110,
        energie: 9,
        zucker: 25,
        rohfaser: 140,
        calcium: 12,
        phosphor: 4,
        magnesium: 2.5,
        zink: 1.5,
        natrium: 0.8,
        lysin: 18,
        methionin: 5,
        threonin: 8
      }
    };
    
    // --- Bedarfstabellen aus der PDF (Werte in Gramm bzw. MJ) ---
    const demandTables = {
      Erhaltung: {
        100: { TM: 2800, Rohfaser: 500, Rohprotein: 119, Energie: 16, Kalzium: 5, Phosphor: 4, Magnesium: 2, Natrium: 1, Zucker: 400 },
        200: { TM: 5000, Rohfaser: 1000, Rohprotein: 195, Energie: 28, Kalzium: 9, Phosphor: 6, Magnesium: 3, Natrium: 1, Zucker: 800 },
        300: { TM: 6500, Rohfaser: 1500, Rohprotein: 270, Energie: 37, Kalzium: 12, Phosphor: 8, Magnesium: 4, Natrium: 2, Zucker: 1200 },
        400: { TM: 8000, Rohfaser: 2000, Rohprotein: 323, Energie: 47, Kalzium: 15, Phosphor: 10, Magnesium: 5, Natrium: 2, Zucker: 1600 },
        500: { TM: 10000, Rohfaser: 2500, Rohprotein: 386, Energie: 55, Kalzium: 17, Phosphor: 12, Magnesium: 6, Natrium: 3, Zucker: 2000 },
        600: { TM: 12000, Rohfaser: 3000, Rohprotein: 444, Energie: 63, Kalzium: 20, Phosphor: 14, Magnesium: 7, Natrium: 3, Zucker: 2400 },
        700: { TM: 12500, Rohfaser: 3500, Rohprotein: 503, Energie: 71, Kalzium: 22, Phosphor: 15, Magnesium: 8, Natrium: 4, Zucker: 2800 },
        800: { TM: 13500, Rohfaser: 4000, Rohprotein: 549, Energie: 78, Kalzium: 25, Phosphor: 17, Magnesium: 9, Natrium: 4, Zucker: 3200 }
      },
      Leichte: {
        100: { TM: 2800, Rohfaser: 500, Rohprotein: 141, Energie: 21, Kalzium: 5, Phosphor: 4, Magnesium: 2, Natrium: 4, Zucker: 400 },
        200: { TM: 5000, Rohfaser: 1000, Rohprotein: 238, Energie: 35, Kalzium: 9, Phosphor: 6, Magnesium: 3, Natrium: 6, Zucker: 800 },
        300: { TM: 6500, Rohfaser: 1500, Rohprotein: 322, Energie: 47, Kalzium: 12, Phosphor: 8, Magnesium: 4, Natrium: 8, Zucker: 1200 },
        400: { TM: 8000, Rohfaser: 2000, Rohprotein: 377, Energie: 58, Kalzium: 15, Phosphor: 10, Magnesium: 5, Natrium: 11, Zucker: 1600 },
        500: { TM: 10000, Rohfaser: 2500, Rohprotein: 445, Energie: 69, Kalzium: 17, Phosphor: 13, Magnesium: 6, Natrium: 15, Zucker: 2000 },
        600: { TM: 12000, Rohfaser: 3000, Rohprotein: 517, Energie: 79, Kalzium: 20, Phosphor: 14, Magnesium: 6, Natrium: 17, Zucker: 2400 },
        700: { TM: 12500, Rohfaser: 3500, Rohprotein: 581, Energie: 88, Kalzium: 22, Phosphor: 15, Magnesium: 7, Natrium: 17, Zucker: 2800 },
        800: { TM: 13500, Rohfaser: 4000, Rohprotein: 643, Energie: 98, Kalzium: 25, Phosphor: 17, Magnesium: 8, Natrium: 19, Zucker: 3200 }
      },
      Mittlere: {
        100: { TM: 2800, Rohfaser: 400, Rohprotein: 153, Energie: 25, Kalzium: 5, Phosphor: 4, Magnesium: 2, Natrium: 6, Zucker: 400 },
        200: { TM: 5000, Rohfaser: 800, Rohprotein: 269, Energie: 42, Kalzium: 9, Phosphor: 6, Magnesium: 3, Natrium: 9, Zucker: 800 },
        300: { TM: 6500, Rohfaser: 1200, Rohprotein: 365, Energie: 56, Kalzium: 12, Phosphor: 8, Magnesium: 4, Natrium: 14, Zucker: 1200 },
        400: { TM: 8000, Rohfaser: 1600, Rohprotein: 456, Energie: 70, Kalzium: 15, Phosphor: 10, Magnesium: 5, Natrium: 20, Zucker: 1600 },
        500: { TM: 10000, Rohfaser: 2000, Rohprotein: 540, Energie: 82, Kalzium: 17, Phosphor: 13, Magnesium: 6, Natrium: 27, Zucker: 2000 },
        600: { TM: 12000, Rohfaser: 2400, Rohprotein: 618, Energie: 95, Kalzium: 20, Phosphor: 14, Magnesium: 6, Natrium: 31, Zucker: 2400 },
        700: { TM: 12500, Rohfaser: 2800, Rohprotein: 695, Energie: 106, Kalzium: 22, Phosphor: 15, Magnesium: 7, Natrium: 30, Zucker: 2800 },
        800: { TM: 13500, Rohfaser: 3200, Rohprotein: 768, Energie: 117, Kalzium: 25, Phosphor: 17, Magnesium: 8, Natrium: 34, Zucker: 3200 }
      },
      Schwere: {
        100: { TM: 2800, Rohfaser: 400, Rohprotein: 183, Energie: 29, Kalzium: 5, Phosphor: 4, Magnesium: 2, Natrium: 9, Zucker: 400 },
        200: { TM: 5000, Rohfaser: 800, Rohprotein: 313, Energie: 48, Kalzium: 9, Phosphor: 6, Magnesium: 3, Natrium: 14, Zucker: 800 },
        300: { TM: 6500, Rohfaser: 1200, Rohprotein: 433, Energie: 66, Kalzium: 12, Phosphor: 8, Magnesium: 4, Natrium: 21, Zucker: 1200 },
        400: { TM: 8000, Rohfaser: 1600, Rohprotein: 513, Energie: 81, Kalzium: 15, Phosphor: 10, Magnesium: 5, Natrium: 29, Zucker: 1600 },
        500: { TM: 10000, Rohfaser: 2000, Rohprotein: 607, Energie: 96, Kalzium: 17, Phosphor: 13, Magnesium: 6, Natrium: 39, Zucker: 2000 },
        600: { TM: 12000, Rohfaser: 2400, Rohprotein: 700, Energie: 110, Kalzium: 20, Phosphor: 14, Magnesium: 6, Natrium: 44, Zucker: 2400 },
        700: { TM: 12500, Rohfaser: 2800, Rohprotein: 776, Energie: 124, Kalzium: 22, Phosphor: 15, Magnesium: 7, Natrium: 44, Zucker: 2800 },
        800: { TM: 13500, Rohfaser: 3200, Rohprotein: 858, Energie: 137, Kalzium: 25, Phosphor: 17, Magnesium: 8, Natrium: 48, Zucker: 3200 }
      }
    };
    
    // --- Lineare Interpolation der Bedarfwerte aus den Tabellen ---
    function getDemandValues(weight, intensityKey) {
      let table = demandTables[intensityKey];
      const weights = [100,200,300,400,500,600,700,800];
      if (weight < 100) weight = 100;
      if (weight > 800) weight = 800;
      let lower = weights[0], upper = weights[weights.length - 1];
      for (let i = 0; i < weights.length; i++) {
        if (weights[i] <= weight) lower = weights[i];
        if (weights[i] >= weight) { upper = weights[i]; break; }
      }
      if (lower === upper) return table[lower];
      let frac = (weight - lower) / (upper - lower);
      let result = {};
      const nutrients = ["TM", "Rohfaser", "Rohprotein", "Energie", "Kalzium", "Phosphor", "Magnesium", "Natrium", "Zucker"];
      nutrients.forEach(nutrient => {
        let lowVal = table[lower][nutrient];
        let upVal = table[upper][nutrient];
        result[nutrient] = lowVal + (upVal - lowVal) * frac;
      });
      return result;
    }
    
    // --- Globale Variablen ---
    let futtermittelListe = [];
    let naechsteId = 1;
    // Bedarfobjekt: Errechnete Zielwerte (in kg bzw. MJ)
    let bedarf = {
      trockensubstanz: 0,
      rohfaser: 0,
      rohprotein: 0,
      energie: 0,
      calcium: 0,
      phosphor: 0,
      magnesium: 0,
      natrium: 0,
      zucker: 0,
      zink: 0,
      lysin: 0,
      methionin: 0,
      threonin: 0
    };
    let gewichtsModus = 'halten';
    
    // --- Event Listener beim Laden des Dokuments ---
    document.addEventListener('DOMContentLoaded', function() {
      addFuttermittel();
      const inputs = ['gewicht', 'zielgewicht', 'pferdetyp', 'jahreszeit', 'aktivitaet', 'haltung'];
      inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', () => {
          if (!document.getElementById('isSenior').checked) updateBedarfsberechnung();
        });
        document.getElementById(id).addEventListener('change', () => {
          if (!document.getElementById('isSenior').checked) updateBedarfsberechnung();
        });
      });
      
      document.getElementById('isSenior').addEventListener('change', function() {
        if (this.checked) {
          document.getElementById('berechnenSenior').classList.remove('hidden');
        } else {
          document.getElementById('berechnenSenior').classList.add('hidden');
          updateBedarfsberechnung();
        }
      });
      
      document.getElementById('berechnenSenior').addEventListener('click', updateBedarfsberechnung);
      document.getElementById('addFuttermittel').addEventListener('click', addFuttermittel);
    });
    
    // --- Futtermittel hinzufügen (inkl. Preset-Auswahl, unverändert wie vorher) ---
    function addFuttermittel() {
      const container = document.getElementById('futtermittelContainer');
      const id = naechsteId++;
      const futtermittel = {
        id,
        name: '',
        menge: 0,
        trockensubstanz: 0,
        rohprotein: 0,
        energie: 0,
        zucker: 0,
        rohfaser: 0,
        calcium: 0,
        phosphor: 0,
        magnesium: 0,
        zink: 0,
        natrium: 0,
        lysin: 0,
        methionin: 0,
        threonin: 0
      };
      futtermittelListe.push(futtermittel);
      
      const div = document.createElement('div');
      div.className = 'mb-2 border rounded border-pink-200';
      div.id = `futtermittel-${id}`;
      div.innerHTML = `
        <div class="flex justify-between items-center p-3 bg-stone-50">
          <div class="w-1/3 mr-2">
            <label class="block text-sm text-stone-700 mb-1">Futtermitteltyp</label>
            <select id="preset-${id}" class="w-full p-2 border border-pink-200 rounded">
              <option value="custom" selected>-- Custom --</option>
              <option value="heu">Heu</option>
              <option value="hafer">Hafer</option>
              <option value="gerste">Gerste</option>
            </select>
          </div>
          <div class="flex-grow">
            <label class="block text-sm text-stone-700 mb-1">Name (optional)</label>
            <input type="text" id="name-${id}" placeholder="Futtermittel eingeben" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div class="w-20 ml-2">
            <label class="block text-sm text-stone-700 mb-1">Menge (kg)</label>
            <input type="number" id="menge-${id}" placeholder="kg" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div class="flex flex-col">
            <button onclick="toggleFuttermittel(${id})" class="p-1 mb-1 rounded hover:bg-pink-100">▼</button>
            <button onclick="removeFuttermittel(${id})" class="p-1 rounded hover:bg-pink-100 text-pink-600">✕</button>
          </div>
        </div>
        <div id="details-${id}" class="p-3 bg-white hidden grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm text-stone-700 mb-1">Trockensubstanz (g/kg):</label>
            <input type="number" id="trockensubstanz-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Rohprotein (g/kg):</label>
            <input type="number" id="rohprotein-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Energie (MJ/kg):</label>
            <input type="number" id="energie-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Zucker (g/kg):</label>
            <input type="number" id="zucker-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Rohfaser (g/kg):</label>
            <input type="number" id="rohfaser-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Calcium (g/kg):</label>
            <input type="number" id="calcium-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Phosphor (g/kg):</label>
            <input type="number" id="phosphor-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Magnesium (g/kg):</label>
            <input type="number" id="magnesium-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Zink (g/kg):</label>
            <input type="number" id="zink-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Natrium (g/kg):</label>
            <input type="number" id="natrium-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Lysin (g/kg):</label>
            <input type="number" id="lysin-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Methionin (g/kg):</label>
            <input type="number" id="methionin-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm text-stone-700 mb-1">Threonin (g/kg):</label>
            <input type="number" id="threonin-${id}" class="w-full p-2 border border-pink-200 rounded">
          </div>
        </div>
      `;
      container.appendChild(div);
      
      document.getElementById(`preset-${id}`).addEventListener('change', (e) => {
        let preset = e.target.value;
        if (preset !== "custom" && feedPresets[preset]) {
          const presetData = feedPresets[preset];
          document.getElementById(`trockensubstanz-${id}`).value = presetData.trockensubstanz;
          document.getElementById(`rohprotein-${id}`).value = presetData.rohprotein;
          document.getElementById(`energie-${id}`).value = presetData.energie;
          document.getElementById(`zucker-${id}`).value = presetData.zucker;
          document.getElementById(`rohfaser-${id}`).value = presetData.rohfaser;
          document.getElementById(`calcium-${id}`).value = presetData.calcium;
          document.getElementById(`phosphor-${id}`).value = presetData.phosphor;
          document.getElementById(`magnesium-${id}`).value = presetData.magnesium;
          document.getElementById(`zink-${id}`).value = presetData.zink;
          document.getElementById(`natrium-${id}`).value = presetData.natrium;
          document.getElementById(`lysin-${id}`).value = presetData.lysin;
          document.getElementById(`methionin-${id}`).value = presetData.methionin;
          document.getElementById(`threonin-${id}`).value = presetData.threonin;
          let nameField = document.getElementById(`name-${id}`);
          if (!nameField.value.trim()) {
            nameField.value = presetData.name;
            updateFuttermittel(id, "name", presetData.name);
          }
          updateFuttermittel(id, "trockensubstanz", presetData.trockensubstanz);
          updateFuttermittel(id, "rohprotein", presetData.rohprotein);
          updateFuttermittel(id, "energie", presetData.energie);
          updateFuttermittel(id, "zucker", presetData.zucker);
          updateFuttermittel(id, "rohfaser", presetData.rohfaser);
          updateFuttermittel(id, "calcium", presetData.calcium);
          updateFuttermittel(id, "phosphor", presetData.phosphor);
          updateFuttermittel(id, "magnesium", presetData.magnesium);
          updateFuttermittel(id, "zink", presetData.zink);
          updateFuttermittel(id, "natrium", presetData.natrium);
          updateFuttermittel(id, "lysin", presetData.lysin);
          updateFuttermittel(id, "methionin", presetData.methionin);
          updateFuttermittel(id, "threonin", presetData.threonin);
        }
      });
      
      const fields = ['name','menge','trockensubstanz','rohprotein','energie','zucker','rohfaser','calcium','phosphor','magnesium','zink','natrium','lysin','methionin','threonin'];
      fields.forEach(field => {
        document.getElementById(`${field}-${id}`).addEventListener('input', (e) => {
          let value = (field === 'name') ? e.target.value : parseFloat(e.target.value);
          if (isNaN(value)) { value = 0; }
          updateFuttermittel(id, field, value);
        });
      });
    }
    
    function updateFuttermittel(id, feld, wert) {
      const futtermittel = futtermittelListe.find(item => item.id === id);
      if (futtermittel) {
        futtermittel[feld] = wert;
        if (!document.getElementById('isSenior').checked) updateBedarfsberechnung();
      }
    }
    
    function removeFuttermittel(id) {
      futtermittelListe = futtermittelListe.filter(item => item.id !== id);
      const element = document.getElementById(`futtermittel-${id}`);
      if (element) { element.remove(); }
      updateBedarfsberechnung();
    }
    
    function toggleFuttermittel(id) {
      const details = document.getElementById(`details-${id}`);
      if (details) {
        details.classList.toggle('hidden');
      }
    }
    
    // --- Bedarfsermittlung anhand der PDF-Werte und Modifier ---
    function updateBedarfsberechnung() {
      const gewicht = parseFloat(document.getElementById('gewicht').value) || 0;
      const zielgewicht = parseFloat(document.getElementById('zielgewicht').value) || 0;
      const pferdetyp = document.getElementById('pferdetyp').value;
      const jahreszeit = document.getElementById('jahreszeit').value;
      const aktivitaet = document.getElementById('aktivitaet').value;
      const haltung = document.getElementById('haltung').value;
      const isSenior = document.getElementById('isSenior').checked;
      
      const gewichtWarnung = document.getElementById('gewichtWarnung');
      const ergebnisBereich = document.getElementById('ergebnisBereich');
      if (gewicht <= 0) {
        gewichtWarnung.classList.remove('hidden');
        ergebnisBereich.classList.add('hidden');
        return;
      } else {
        gewichtWarnung.classList.add('hidden');
        ergebnisBereich.classList.remove('hidden');
      }
      
      if (zielgewicht > 0) {
        if (zielgewicht > gewicht + 5) {
          gewichtsModus = 'zunehmen';
        } else if (zielgewicht < gewicht - 5) {
          gewichtsModus = 'abnehmen';
        } else {
          gewichtsModus = 'halten';
        }
      } else {
        gewichtsModus = 'halten';
      }
      
      // Wählen der passenden Tabelle (Basistabelle: Erhaltung, Leichte, Mittlere oder Schwere Arbeit)
      const intensityMapping = {
        "erhaltung": "Erhaltung",
        "leicht": "Leichte",
        "mittel": "Mittlere",
        "schwer": "Schwere"
      };
      const selectedTable = intensityMapping[aktivitaet] || "Erhaltung";
      
      // Berechne Basisbedarf aus der PDF-Tabelle (Werte in g bzw. MJ)
      let baseDemand = getDemandValues(gewicht, selectedTable);
      
      // Modifier: Senior, Winter und Haltungsform (außer Standard) jeweils +10%
      let multiplier = 1.0;
      if (isSenior) multiplier *= 1.10;
      if (jahreszeit === "winter") multiplier *= 1.10;
      if (haltung !== "standard") multiplier *= 1.10;
      
      // Wende den Modifier an
      for (let key in baseDemand) {
        baseDemand[key] *= multiplier;
      }
      
      // Setze die Zielwerte (Bedarf) – Umrechnung in kg (außer Energie, die in MJ bleibt)
      bedarf.trockensubstanz = baseDemand.TM / 1000;
      bedarf.rohfaser = baseDemand.Rohfaser / 1000;
      bedarf.rohprotein = baseDemand.Rohprotein / 1000;
      bedarf.energie = baseDemand.Energie;
      bedarf.calcium = baseDemand.Kalzium / 1000;
      bedarf.phosphor = baseDemand.Phosphor / 1000;
      bedarf.magnesium = baseDemand.Magnesium / 1000;
      bedarf.natrium = baseDemand.Natrium / 1000;
      bedarf.zucker = baseDemand.Zucker / 1000;
      
      // Zusätzliche Nährstoffe anhand von Standardfaktoren (bezogen auf TM)
      bedarf.zink = bedarf.trockensubstanz * 0.002;
      bedarf.lysin = bedarf.trockensubstanz * 0.004;
      bedarf.methionin = bedarf.trockensubstanz * 0.0015;
      bedarf.threonin = bedarf.trockensubstanz * 0.0025;
      
      // Anzeige der ermittelten Bedarfswerte
      document.getElementById('bedarfHeu').textContent = (baseDemand.TM / 1000).toFixed(2); // als Basiswert
      document.getElementById('bedarfTrockensubstanz').textContent = bedarf.trockensubstanz.toFixed(2);
      document.getElementById('bedarfRohfaser').textContent = bedarf.rohfaser.toFixed(2);
      document.getElementById('bedarfRohprotein').textContent = bedarf.rohprotein.toFixed(2);
      document.getElementById('bedarfEnergie').textContent = bedarf.energie.toFixed(2);
      document.getElementById('bedarfCalcium').textContent = bedarf.calcium.toFixed(2);
      document.getElementById('bedarfPhosphor').textContent = bedarf.phosphor.toFixed(2);
      document.getElementById('bedarfMagnesium').textContent = bedarf.magnesium.toFixed(2);
      document.getElementById('bedarfNatrium').textContent = bedarf.natrium.toFixed(2);
      document.getElementById('bedarfZucker').textContent = bedarf.zucker.toFixed(2);
      document.getElementById('bedarfZink').textContent = bedarf.zink.toFixed(2);
      document.getElementById('bedarfLysin').textContent = bedarf.lysin.toFixed(2);
      document.getElementById('bedarfMethionin').textContent = bedarf.methionin.toFixed(2);
      document.getElementById('bedarfThreonin').textContent = bedarf.threonin.toFixed(2);
      
      // Angebot (Gesamt) wird aus den vom Nutzer eingegebenen Futtermitteln ermittelt
      updateGesamtwerte();
      updateAnpassungen();
    }
    
    // --- Berechnung des Gesamtangebots (nur aus den Futtermittel-Eingaben) ---
    function updateGesamtwerte() {
      let gesamtMenge = 0;
      let gesamtTrockensubstanz = 0;
      let gesamtRohprotein = 0;
      let gesamtEnergie = 0;
      let gesamtZucker = 0;
      let gesamtRohfaser = 0;
      let gesamtCalcium = 0;
      let gesamtPhosphor = 0;
      let gesamtMagnesium = 0;
      let gesamtNatrium = 0;
      let gesamtZink = 0;
      let gesamtLysin = 0;
      let gesamtMethionin = 0;
      let gesamtThreonin = 0;
      
      futtermittelListe.forEach(item => {
        gesamtMenge += item.menge;
        gesamtTrockensubstanz += item.menge * (item.trockensubstanz / 1000);
        gesamtRohprotein += item.menge * (item.rohprotein / 1000);
        gesamtEnergie += item.menge * item.energie;
        gesamtZucker += item.menge * (item.zucker / 1000);
        gesamtRohfaser += item.menge * (item.rohfaser / 1000);
        gesamtCalcium += item.menge * (item.calcium / 1000);
        gesamtPhosphor += item.menge * (item.phosphor / 1000);
        gesamtMagnesium += item.menge * (item.magnesium / 1000);
        gesamtNatrium += item.menge * (item.natrium / 1000);
        gesamtZink += item.menge * (item.zink / 1000);
        gesamtLysin += item.menge * (item.lysin / 1000);
        gesamtMethionin += item.menge * (item.methionin / 1000);
        gesamtThreonin += item.menge * (item.threonin / 1000);
      });
      
      document.getElementById('gesamtFuttermenge').textContent = gesamtMenge.toFixed(2);
      document.getElementById('gesamtTrockensubstanz').textContent = gesamtTrockensubstanz.toFixed(2);
      document.getElementById('gesamtRohprotein').textContent = gesamtRohprotein.toFixed(2);
      document.getElementById('gesamtEnergie').textContent = gesamtEnergie.toFixed(2);
      document.getElementById('gesamtZucker').textContent = gesamtZucker.toFixed(2);
      document.getElementById('gesamtRohfaser').textContent = gesamtRohfaser.toFixed(2);
      document.getElementById('gesamtCalcium').textContent = gesamtCalcium.toFixed(2);
      document.getElementById('gesamtPhosphor').textContent = gesamtPhosphor.toFixed(2);
      document.getElementById('gesamtMagnesium').textContent = gesamtMagnesium.toFixed(2);
      document.getElementById('gesamtNatrium').textContent = gesamtNatrium.toFixed(2);
      document.getElementById('gesamtZink').textContent = gesamtZink.toFixed(2);
      document.getElementById('gesamtLysin').textContent = gesamtLysin.toFixed(2);
      document.getElementById('gesamtMethionin').textContent = gesamtMethionin.toFixed(2);
      document.getElementById('gesamtThreonin').textContent = gesamtThreonin.toFixed(2);
      
      updateAmpelfarbe('ampel-trockensubstanz', gesamtTrockensubstanz, bedarf.trockensubstanz);
      updateAmpelfarbe('ampel-rohprotein', gesamtRohprotein, bedarf.rohprotein);
      updateAmpelfarbe('ampel-energie', gesamtEnergie, bedarf.energie);
      updateAmpelfarbe('ampel-zucker', gesamtZucker, bedarf.zucker);
      updateAmpelfarbe('ampel-rohfaser', gesamtRohfaser, bedarf.rohfaser);
      updateAmpelfarbe('ampel-calcium', gesamtCalcium, bedarf.calcium);
      updateAmpelfarbe('ampel-phosphor', gesamtPhosphor, bedarf.phosphor);
      updateAmpelfarbe('ampel-magnesium', gesamtMagnesium, bedarf.magnesium);
      updateAmpelfarbe('ampel-natrium', gesamtNatrium, bedarf.natrium);
      updateAmpelfarbe('ampel-zink', gesamtZink, bedarf.zink);
      updateAmpelfarbe('ampel-lysin', gesamtLysin, bedarf.lysin);
      updateAmpelfarbe('ampel-methionin', gesamtMethionin, bedarf.methionin);
      updateAmpelfarbe('ampel-threonin', gesamtThreonin, bedarf.threonin);
    }
    
    function updateAmpelfarbe(elementId, supply, requirement) {
      const el = document.getElementById(elementId);
      if (requirement > 0) {
        const percent = (supply / requirement) * 100;
        if (percent >= 90 && percent <= 110) {
          el.className = 'w-4 h-4 rounded-full mr-2 bg-green-500';
        } else if ((percent >= 70 && percent < 90) || (percent > 110 && percent <= 130)) {
          el.className = 'w-4 h-4 rounded-full mr-2 bg-yellow-500';
        } else {
          el.className = 'w-4 h-4 rounded-full mr-2 bg-red-500';
        }
      } else {
        el.className = 'w-4 h-4 rounded-full mr-2 bg-gray-300';
      }
    }
    
    function updateAnpassungen() {
      const anpassungenBereich = document.getElementById('anpassungenBereich');
      const anpassungenListe = document.getElementById('anpassungenListe');
      anpassungenListe.innerHTML = '';
      
      if (gewichtsModus === 'zunehmen') {
        const li = document.createElement('li');
        li.textContent = 'Gewichtsziel: +10% Energiebedarf für Gewichtszunahme';
        anpassungenListe.appendChild(li);
      } else if (gewichtsModus === 'abnehmen') {
        const li = document.createElement('li');
        li.textContent = 'Gewichtsziel: -15% Energiebedarf für Gewichtsabnahme';
        anpassungenListe.appendChild(li);
      }
      if (document.getElementById('jahreszeit').value === 'winter') {
        const li = document.createElement('li');
        li.textContent = 'Winter: +10% Energiebedarf';
        anpassungenListe.appendChild(li);
      }
      if (document.getElementById('isSenior').checked) {
        const li = document.createElement('li');
        li.textContent = 'Senior: +10% Energiebedarf';
        anpassungenListe.appendChild(li);
      }
      if (document.getElementById('haltung').value !== 'standard') {
        const li = document.createElement('li');
        li.textContent = 'Haltungsform (' + document.getElementById('haltung').value + '): +10% Energiebedarf';
        anpassungenListe.appendChild(li);
      }
      
      if (anpassungenListe.childNodes.length > 0) {
        anpassungenBereich.classList.remove('hidden');
      } else {
        anpassungenBereich.classList.add('hidden');
      }
    }
  </script>
</body>
</html>
