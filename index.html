<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pferdeliebehealthy Rationsrechner - Erweiterte Version</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; }
  </style>
</head>
<body class="bg-stone-50">
  <div class="container mx-auto p-4 max-w-4xl">
    <!-- Header -->
    <div class="bg-stone-100 p-4 text-center rounded-t-lg border-b border-pink-200">
      <h1 class="text-2xl font-bold text-pink-700 mb-1">Pferdeliebehealthy.de</h1>
      <p class="text-pink-600">Mit natürlicher Fütterung zu einem gesunden Pferd</p>
    </div>
    <!-- Titel -->
    <div class="bg-pink-50 p-3 text-center border-b border-pink-200">
      <h2 class="text-xl font-bold text-stone-700">Rationsrechner Tool für Pferde (Erweiterte Version)</h2>
    </div>
    
    <div class="p-4">
      <!-- Pferdedetails -->
      <div class="mb-6 p-4 bg-stone-100 rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Pferdedetails:</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Aktuelles Gewicht (kg)</label>
            <input type="number" id="gewicht" placeholder="z.B. 600" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Zielgewicht (kg)</label>
            <input type="number" id="zielgewicht" placeholder="Optional" class="w-full p-2 border border-pink-200 rounded">
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Pferdetyp</label>
            <select id="pferdetyp" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="shetlandpony">Shetland Pony</option>
              <option value="pony">Pony</option>
              <option value="warmblut" selected>Warmblut</option>
              <option value="vollblut">Vollblut</option>
              <option value="kaltblut">Kaltblut</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Jahreszeit</label>
            <select id="jahreszeit" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="normal" selected>Frühling/Sommer/Herbst</option>
              <option value="winter">Winter (+10%)</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Arbeitsintensität</label>
            <select id="aktivitaet" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="erhaltung" selected>Erhaltung</option>
              <option value="leicht">Leichte Arbeit</option>
              <option value="mittel">Mittlere Arbeit</option>
              <option value="schwer">Schwere Arbeit</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-stone-700 mb-1">Haltungsform</label>
            <select id="haltung" class="w-full p-2 border rounded border-pink-200 text-stone-700">
              <option value="standard" selected>Standard</option>
              <option value="offenstall">Offenstall (+10%)</option>
              <option value="aktivstall">Aktivstall (+15%)</option>
            </select>
          </div>
          <div class="flex items-center">
            <label class="flex items-center text-stone-700 cursor-pointer">
              <input type="checkbox" id="isSenior" class="mr-2 h-4 w-4 border-pink-300 text-pink-500">
              Senior-Pferd (+15% Energiebedarf)
            </label>
          </div>
          <!-- Berechnen-Button für Senior-Pferd -->
          <div class="md:col-span-2">
            <button id="berechnenButton" class="w-full p-2 bg-pink-400 hover:bg-pink-500 text-white rounded">Berechnen</button>
          </div>
        </div>
      </div>
      
      <!-- Futtermittel -->
      <h3 class="font-bold mb-3 text-pink-700">Futtermittel (Werte in g/kg bzw. MJ/kg)</h3>
      <div id="futtermittelContainer">
        <!-- Futtermittel werden hier dynamisch hinzugefügt -->
      </div>
      <button id="addFuttermittel" class="mt-3 w-full p-2 bg-pink-300 hover:bg-pink-400 text-stone-800 rounded">
        + Futtermittel hinzufügen
      </button>
      
      <!-- Bedarfsanalyse -->
      <div class="mt-6 p-4 bg-stone-100 rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Bedarfsanalyse (g/kg bzw. MJ/kg)</h3>
        <div id="gewichtWarnung" class="mb-4 p-2 bg-stone-200 border border-stone-300 rounded flex items-center text-stone-800">
          <span class="mr-2">⚠️</span>
          Bitte geben Sie das Gewicht des Pferdes ein, um die Bedarfsanalyse zu sehen.
        </div>
        
        <div id="ergebnisBereich" class="hidden">
          <div class="grid grid-cols-1 gap-3">
            <!-- Jeweils eine Zeile pro Nährstoff mit Ampel, Gesamtwert und Bedarf -->
            <div class="flex items-center">
              <div id="tsAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Trockensubstanz: <span id="gesamtTS">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfTS">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="roproteinAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Rohprotein: <span id="gesamtRoprotein">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfRoprotein">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="energieAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Energie: <span id="gesamtEnergie">0.00</span> MJ/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfEnergie">0.00</span> MJ/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="zuckerAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Zucker: <span id="gesamtZucker">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Max. empfohlen: <span id="bedarfZucker">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="rohfaserAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Rohfaser: <span id="gesamtRohfaser">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfRohfaser">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="calciumPhosphorAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Calcium &amp; Phosphor: <span id="gesamtCalciumPhosphor">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfCalciumPhosphor">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="magnesiumAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Magnesium: <span id="gesamtMagnesium">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfMagnesium">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="zinkAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Zink: <span id="gesamtZink">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfZink">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="natriumAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Natrium: <span id="gesamtNatrium">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfNatrium">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="lysinAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Lysin: <span id="gesamtLysin">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfLysin">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="methioninAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Methionin: <span id="gesamtMethionin">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfMethionin">0.00</span> g/kg</p>
              </div>
            </div>
            <div class="flex items-center">
              <div id="threoninAmpel" class="w-4 h-4 rounded-full mr-2 bg-gray-300"></div>
              <div>
                <p class="text-stone-700">Threonin: <span id="gesamtThreonin">0.00</span> g/kg</p>
                <p class="text-xs text-pink-600">Bedarf: <span id="bedarfThreonin">0.00</span> g/kg</p>
              </div>
            </div>
          </div>
          
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-green-500"></div>
              <p class="text-xs text-stone-700">Optimal</p>
            </div>
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-yellow-500"></div>
              <p class="text-xs text-stone-700">Grenzwertig</p>
            </div>
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-2 bg-red-500"></div>
              <p class="text-xs text-stone-700">Kritisch</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Zusammenfassung -->
      <div class="mt-4 p-4 bg-white rounded border border-pink-200">
        <h3 class="font-bold mb-3 text-pink-700">Weitere Informationen:</h3>
        <p class="text-sm text-stone-700 mb-2">• Gesamtfuttermenge: <span id="gesamtFuttermenge">0.00</span> g/kg</p>
        <div id="anpassungenBereich" class="mt-2 p-3 rounded bg-stone-100 hidden">
          <p class="text-sm font-semibold text-pink-700 mb-1">Aktive Anpassungen:</p>
          <ul id="anpassungenListe" class="text-xs text-stone-600 pl-4 list-disc">
            <!-- Dynamische Anpassungen -->
          </ul>
        </div>
        <p class="text-sm text-stone-700 mt-2">• Die Ampelfarben zeigen, ob die Nährstoffzufuhr im optimalen (grün), grenzwertigen (gelb) oder kritischen (rot) Bereich liegt.</p>
      </div>
    </div>
  </div>
  
  <script>
    // Globale Variablen
    let futtermittelListe = [];
    let naechsteId = 1;
    let bedarf = {}; // erweitert um alle Nährstoffe
    let gewichtsModus = 'halten';
    
    // Event Listener
    document.addEventListener('DOMContentLoaded', function() {
      addFuttermittel();
      updateBedarfsberechnung();
      
      document.getElementById('gewicht').addEventListener('input', updateBedarfsberechnung);
      document.getElementById('zielgewicht').addEventListener('input', updateBedarfsberechnung);
      document.getElementById('pferdetyp').addEventListener('change', updateBedarfsberechnung);
      document.getElementById('jahreszeit').addEventListener('change', updateBedarfsberechnung);
      document.getElementById('aktivitaet').addEventListener('change', updateBedarfsberechnung);
      document.getElementById('haltung').addEventListener('change', updateBedarfsberechnung);
      document.getElementById('isSenior').addEventListener('change', updateBedarfsberechnung);
      document.getElementById('berechnenButton').addEventListener('click', updateBedarfsberechnung);
      
      document.getElementById('addFuttermittel').addEventListener('click', addFuttermittel);
    });
    
    // Futtermittel hinzufügen
    function addFuttermittel() {
      const container = document.getElementById('futtermittelContainer');
      const id = naechsteId++;
      
      const futtermittel = {
        id,
        name: '',
        menge: 0,
        ts: 0,
        roprotein: 0,
        energie: 0,
        zucker: 0,
        rohfaser: 0,
        calciumPhosphor: 0,
        magnesium: 0,
        zink: 0,
        natrium: 0,
        lysin: 0,
        methionin: 0,
        threonin: 0
      };
      
      futtermittelListe.push(futtermittel);
      
      const div = document.createElement('div');
      div.className = 'mb-2 border rounded border-pink-200';
      div.id = `futtermittel-${id}`;
      div.innerHTML = `
        <div class="flex justify-between items-center p-3 bg-stone-50">
          <div class="flex-grow mr-2">
            <input 
              type="text" 
              id="name-${id}"
              placeholder="Futtermittel eingeben" 
              class="w-full p-2 border border-pink-200 rounded"
            />
          </div>
          <div class="flex items-center">
            <input 
              type="number" 
              id="menge-${id}"
              placeholder="Menge (g/kg)" 
              class="w-24 mr-2 p-2 border border-pink-200 rounded"
            />
            <button 
              onclick="toggleFuttermittel(${id})"
              class="p-1 mr-1 rounded hover:bg-pink-100"
            >
              ▼
            </button>
            <button 
              onclick="removeFuttermittel(${id})" 
              class="p-1 rounded hover:bg-pink-100 text-pink-600"
            >
              ✕
            </button>
          </div>
        </div>
        <div id="details-${id}" class="p-3 bg-white hidden">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="block text-sm text-stone-700 mb-1">Trockensubstanz (g/kg):</label>
              <input 
                type="number" 
                id="ts-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Rohprotein (g/kg):</label>
              <input 
                type="number" 
                id="roprotein-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Energie (MJ/kg):</label>
              <input 
                type="number" 
                id="energie-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Zucker (g/kg):</label>
              <input 
                type="number" 
                id="zucker-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Rohfaser (g/kg):</label>
              <input 
                type="number" 
                id="rohfaser-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Calcium &amp; Phosphor (g/kg):</label>
              <input 
                type="number" 
                id="calciumPhosphor-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Magnesium (g/kg):</label>
              <input 
                type="number" 
                id="magnesium-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Zink (g/kg):</label>
              <input 
                type="number" 
                id="zink-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Natrium (g/kg):</label>
              <input 
                type="number" 
                id="natrium-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Lysin (g/kg):</label>
              <input 
                type="number" 
                id="lysin-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Methionin (g/kg):</label>
              <input 
                type="number" 
                id="methionin-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
            <div>
              <label class="block text-sm text-stone-700 mb-1">Threonin (g/kg):</label>
              <input 
                type="number" 
                id="threonin-${id}"
                class="w-full p-2 border border-pink-200 rounded"
              />
            </div>
          </div>
        </div>
      `;
      
      container.appendChild(div);
      
      // Event Listener für alle Eingabefelder des Futtermittels
      document.getElementById(`name-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'name', e.target.value));
      document.getElementById(`menge-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'menge', parseFloat(e.target.value) || 0));
      document.getElementById(`ts-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'ts', parseFloat(e.target.value) || 0));
      document.getElementById(`roprotein-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'roprotein', parseFloat(e.target.value) || 0));
      document.getElementById(`energie-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'energie', parseFloat(e.target.value) || 0));
      document.getElementById(`zucker-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'zucker', parseFloat(e.target.value) || 0));
      document.getElementById(`rohfaser-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'rohfaser', parseFloat(e.target.value) || 0));
      document.getElementById(`calciumPhosphor-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'calciumPhosphor', parseFloat(e.target.value) || 0));
      document.getElementById(`magnesium-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'magnesium', parseFloat(e.target.value) || 0));
      document.getElementById(`zink-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'zink', parseFloat(e.target.value) || 0));
      document.getElementById(`natrium-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'natrium', parseFloat(e.target.value) || 0));
      document.getElementById(`lysin-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'lysin', parseFloat(e.target.value) || 0));
      document.getElementById(`methionin-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'methionin', parseFloat(e.target.value) || 0));
      document.getElementById(`threonin-${id}`).addEventListener('input', (e) => updateFuttermittel(id, 'threonin', parseFloat(e.target.value) || 0));
    }
    
    // Aktualisiert einen einzelnen Wert eines Futtermittels
    function updateFuttermittel(id, feld, wert) {
      const futtermittel = futtermittelListe.find(item => item.id === id);
      if (futtermittel) {
        futtermittel[feld] = wert;
        updateBedarfsberechnung();
      }
    }
    
    // Futtermittel entfernen
    function removeFuttermittel(id) {
      futtermittelListe = futtermittelListe.filter(item => item.id !== id);
      const element = document.getElementById(`futtermittel-${id}`);
      if (element) { element.remove(); }
      updateBedarfsberechnung();
    }
    
    // Details anzeigen/verbergen
    function toggleFuttermittel(id) {
      const details = document.getElementById(`details-${id}`);
      if (details) {
        details.classList.toggle('hidden');
        const button = details.previousElementSibling.querySelector('button');
        if (button) {
          button.textContent = details.classList.contains('hidden') ? '▼' : '▲';
        }
      }
    }
    
    // Bedarfsberechnung (inkl. Umrechnung in g/kg) und Ableitung der Nährstoffbedarfe
    function updateBedarfsberechnung() {
      const gewicht = parseFloat(document.getElementById('gewicht').value) || 0;
      const zielgewicht = parseFloat(document.getElementById('zielgewicht').value) || 0;
      const pferdetyp = document.getElementById('pferdetyp').value;
      const aktivitaet = document.getElementById('aktivitaet').value;
      const haltung = document.getElementById('haltung').value;
      const jahreszeit = document.getElementById('jahreszeit').value;
      const isSenior = document.getElementById('isSenior').checked;
      
      const gewichtWarnung = document.getElementById('gewichtWarnung');
      const ergebnisBereich = document.getElementById('ergebnisBereich');
      
      if (gewicht <= 0) {
        gewichtWarnung.classList.remove('hidden');
        ergebnisBereich.classList.add('hidden');
        return;
      } else {
        gewichtWarnung.classList.add('hidden');
        ergebnisBereich.classList.remove('hidden');
      }
      
      // Gewichtsmodus bestimmen
      if (zielgewicht > 0) {
        if (zielgewicht > gewicht + 5) {
          gewichtsModus = 'zunehmen';
        } else if (zielgewicht < gewicht - 5) {
          gewichtsModus = 'abnehmen';
        } else {
          gewichtsModus = 'halten';
        }
      } else {
        gewichtsModus = 'halten';
      }
      
      // Heubedarf berechnen (1,5kg/100kg, hier in kg) und anschließende Anpassungen
      let heuBedarf = gewicht * 0.015; // in kg
      let typFaktor = 1.0;
      switch(pferdetyp) {
        case 'shetlandpony': typFaktor = 0.9; break;
        case 'pony': typFaktor = 0.95; break;
        case 'vollblut': typFaktor = 1.1; break;
        case 'warmblut': typFaktor = 1.0; break;
        case 'kaltblut': typFaktor = 0.95; break;
        default: typFaktor = 1.0;
      }
      heuBedarf *= typFaktor;
      switch(aktivitaet) {
        case 'leicht': heuBedarf *= 1.1; break;
        case 'mittel': heuBedarf *= 1.2; break;
        case 'schwer': heuBedarf *= 1.3; break;
        default: break;
      }
      if (haltung === 'offenstall') {
        heuBedarf *= 1.1;
      } else if (haltung === 'aktivstall') {
        heuBedarf *= 1.15;
      }
      if (jahreszeit === 'winter') {
        heuBedarf *= 1.1;
      }
      if (isSenior) {
        heuBedarf *= 1.15;
      }
      if (gewichtsModus === 'zunehmen') {
        heuBedarf *= 1.1;
      } else if (gewichtsModus === 'abnehmen') {
        heuBedarf *= 0.85;
      }
      
      // Umrechnung in g/kg Körpergewicht
      const heuBedarf_gPerKg = (heuBedarf * 1000) / gewicht;
      
      // Platzhalter-Formeln zur Berechnung der Nährstoffbedarfe
      const tsBedarf = heuBedarf_gPerKg * 0.9;
      const roproteinBedarf = tsBedarf * 0.09;
      const energieBedarf = tsBedarf * 0.5;
      const zuckerBedarf = tsBedarf * 0.1;
      const rohfaserBedarf = tsBedarf * 0.2;
      const calciumPhosphorBedarf = tsBedarf * 0.03;
      const magnesiumBedarf = tsBedarf * 0.01;
      const zinkBedarf = tsBedarf * 0.005;
      const natriumBedarf = tsBedarf * 0.004;
      const lysinBedarf = tsBedarf * 0.006;
      const methioninBedarf = tsBedarf * 0.003;
      const threoninBedarf = tsBedarf * 0.002;
      
      bedarf = {
        heu: heuBedarf_gPerKg,
        ts: tsBedarf,
        roprotein: roproteinBedarf,
        energie: energieBedarf,
        zucker: zuckerBedarf,
        rohfaser: rohfaserBedarf,
        calciumPhosphor: calciumPhosphorBedarf,
        magnesium: magnesiumBedarf,
        zink: zinkBedarf,
        natrium: natriumBedarf,
        lysin: lysinBedarf,
        methionin: methioninBedarf,
        threonin: threoninBedarf
      };
      
      // Aktualisiere die Bedarf-Anzeige
      document.getElementById('bedarfTS').textContent = tsBedarf.toFixed(2);
      document.getElementById('bedarfRoprotein').textContent = roproteinBedarf.toFixed(2);
      document.getElementById('bedarfEnergie').textContent = energieBedarf.toFixed(2);
      document.getElementById('bedarfZucker').textContent = zuckerBedarf.toFixed(2);
      document.getElementById('bedarfRohfaser').textContent = rohfaserBedarf.toFixed(2);
      document.getElementById('bedarfCalciumPhosphor').textContent = calciumPhosphorBedarf.toFixed(2);
      document.getElementById('bedarfMagnesium').textContent = magnesiumBedarf.toFixed(2);
      document.getElementById('bedarfZink').textContent = zinkBedarf.toFixed(2);
      document.getElementById('bedarfNatrium').textContent = natriumBedarf.toFixed(2);
      document.getElementById('bedarfLysin').textContent = lysinBedarf.toFixed(2);
      document.getElementById('bedarfMethionin').textContent = methioninBedarf.toFixed(2);
      document.getElementById('bedarfThreonin').textContent = threoninBedarf.toFixed(2);
      
      updateGesamtwerte();
      updateAnpassungen();
    }
    
    // Berechnet die aggregierten Nährstoffwerte aus den Futtermitteln
    function updateGesamtwerte() {
      let gesamtMenge = 0;
      let gesamtTS = 0;
      let gesamtRoprotein = 0;
      let gesamtEnergie = 0;
      let gesamtZucker = 0;
      let gesamtRohfaser = 0;
      let gesamtCalciumPhosphor = 0;
      let gesamtMagnesium = 0;
      let gesamtZink = 0;
      let gesamtNatrium = 0;
      let gesamtLysin = 0;
      let gesamtMethionin = 0;
      let gesamtThreonin = 0;
      
      futtermittelListe.forEach(item => {
        // Die Futtermenge (in g/kg) wird als Anteil (kg Futter pro kg Körpergewicht) = menge/1000 betrachtet.
        gesamtMenge += item.menge;
        gesamtTS += (item.menge / 1000) * item.ts;
        gesamtRoprotein += (item.menge / 1000) * item.roprotein;
        gesamtEnergie += (item.menge / 1000) * item.energie;
        gesamtZucker += (item.menge / 1000) * item.zucker;
        gesamtRohfaser += (item.menge / 1000) * item.rohfaser;
        gesamtCalciumPhosphor += (item.menge / 1000) * item.calciumPhosphor;
        gesamtMagnesium += (item.menge / 1000) * item.magnesium;
        gesamtZink += (item.menge / 1000) * item.zink;
        gesamtNatrium += (item.menge / 1000) * item.natrium;
        gesamtLysin += (item.menge / 1000) * item.lysin;
        gesamtMethionin += (item.menge / 1000) * item.methionin;
        gesamtThreonin += (item.menge / 1000) * item.threonin;
      });
      
      document.getElementById('gesamtFuttermenge').textContent = gesamtMenge.toFixed(2);
      document.getElementById('gesamtTS').textContent = gesamtTS.toFixed(2);
      document.getElementById('gesamtRoprotein').textContent = gesamtRoprotein.toFixed(2);
      document.getElementById('gesamtEnergie').textContent = gesamtEnergie.toFixed(2);
      document.getElementById('gesamtZucker').textContent = gesamtZucker.toFixed(2);
      document.getElementById('gesamtRohfaser').textContent = gesamtRohfaser.toFixed(2);
      document.getElementById('gesamtCalciumPhosphor').textContent = gesamtCalciumPhosphor.toFixed(2);
      document.getElementById('gesamtMagnesium').textContent = gesamtMagnesium.toFixed(2);
      document.getElementById('gesamtZink').textContent = gesamtZink.toFixed(2);
      document.getElementById('gesamtNatrium').textContent = gesamtNatrium.toFixed(2);
      document.getElementById('gesamtLysin').textContent = gesamtLysin.toFixed(2);
      document.getElementById('gesamtMethionin').textContent = gesamtMethionin.toFixed(2);
      document.getElementById('gesamtThreonin').textContent = gesamtThreonin.toFixed(2);
      
      updateAmpelfarben({
        ts: gesamtTS,
        roprotein: gesamtRoprotein,
        energie: gesamtEnergie,
        zucker: gesamtZucker,
        rohfaser: gesamtRohfaser,
        calciumPhosphor: gesamtCalciumPhosphor,
        magnesium: gesamtMagnesium,
        zink: gesamtZink,
        natrium: gesamtNatrium,
        lysin: gesamtLysin,
        methionin: gesamtMethionin,
        threonin: gesamtThreonin
      });
    }
    
    // Aktualisiert die Ampelsymbole für jeden Nährstoff
    function updateAmpelfarben(gesamt) {
      function setAmpel(nutrient, elementId) {
        const req = bedarf[nutrient];
        const total = gesamt[nutrient];
        const el = document.getElementById(elementId);
        if (req > 0) {
          const percent = (total / req) * 100;
          if (percent >= 80 && percent <= 120) {
            el.className = 'w-4 h-4 rounded-full mr-2 bg-green-500';
          } else if ((percent >= 60 && percent < 80) || (percent > 120 && percent <= 140)) {
            el.className = 'w-4 h-4 rounded-full mr-2 bg-yellow-500';
          } else {
            el.className = 'w-4 h-4 rounded-full mr-2 bg-red-500';
          }
        } else {
          el.className = 'w-4 h-4 rounded-full mr-2 bg-gray-300';
        }
      }
      
      setAmpel('ts', 'tsAmpel');
      setAmpel('roprotein', 'roproteinAmpel');
      setAmpel('energie', 'energieAmpel');
      setAmpel('zucker', 'zuckerAmpel');
      setAmpel('rohfaser', 'rohfaserAmpel');
      setAmpel('calciumPhosphor', 'calciumPhosphorAmpel');
      setAmpel('magnesium', 'magnesiumAmpel');
      setAmpel('zink', 'zinkAmpel');
      setAmpel('natrium', 'natriumAmpel');
      setAmpel('lysin', 'lysinAmpel');
      setAmpel('methionin', 'methioninAmpel');
      setAmpel('threonin', 'threoninAmpel');
    }
    
    // Zeigt die aktiven Anpassungen (z. B. saisonale, senior- oder arbeitsbezogene)
    function updateAnpassungen() {
      const anpassungenBereich = document.getElementById('anpassungenBereich');
      const anpassungenListe = document.getElementById('anpassungenListe');
      const pferdetyp = document.getElementById('pferdetyp').value;
      const aktivitaet = document.getElementById('aktivitaet').value;
      const haltung = document.getElementById('haltung').value;
      const jahreszeit = document.getElementById('jahreszeit').value;
      const isSenior = document.getElementById('isSenior').checked;
      
      anpassungenListe.innerHTML = '';
      
      if (gewichtsModus === 'zunehmen') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +10% für Gewichtszunahme';
        anpassungenListe.appendChild(li);
      } else if (gewichtsModus === 'abnehmen') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf -15% für Gewichtsabnahme';
        anpassungenListe.appendChild(li);
      }
      
      if (jahreszeit === 'winter') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +10% für Winterzeit';
        anpassungenListe.appendChild(li);
      }
      
      if (isSenior) {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +15% für Senior-Pferd';
        anpassungenListe.appendChild(li);
      }
      
      if (haltung === 'offenstall') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +10% für Offenstallhaltung';
        anpassungenListe.appendChild(li);
      } else if (haltung === 'aktivstall') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +15% für Aktivstallhaltung';
        anpassungenListe.appendChild(li);
      }
      
      if (aktivitaet === 'leicht') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +10% für leichte Arbeit';
        anpassungenListe.appendChild(li);
      } else if (aktivitaet === 'mittel') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +20% für mittlere Arbeit';
        anpassungenListe.appendChild(li);
      } else if (aktivitaet === 'schwer') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +30% für schwere Arbeit';
        anpassungenListe.appendChild(li);
      }
      
      if (pferdetyp === 'vollblut') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf +10% für Vollbluttyp';
        anpassungenListe.appendChild(li);
      } else if (pferdetyp === 'pony' || pferdetyp === 'kaltblut') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf -5% für effiziente Futterverwertung';
        anpassungenListe.appendChild(li);
      } else if (pferdetyp === 'shetlandpony') {
        const li = document.createElement('li');
        li.textContent = 'Energiebedarf -10% für sehr effiziente Futterverwertung';
        anpassungenListe.appendChild(li);
      }
      
      if (anpassungenListe.childNodes.length > 0) {
        anpassungenBereich.classList.remove('hidden');
      } else {
        anpassungenBereich.classList.add('hidden');
      }
    }
  </script>
</body>
</html>
